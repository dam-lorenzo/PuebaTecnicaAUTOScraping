import unittest
import os

try:
    from crawler.crawler import Crawler, CSVS_PATH
except ModuleNotFoundError:
    import sys
    base_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
    sys.path.append(base_dir)
    from crawler.crawler import Crawler, CSVS_PATH

class CrawlerTests(unittest.TestCase):

    def setUp(self):
        self.crawler = Crawler()

    def test_get_product_categories(self):
        categories = [
            '/Tecnología/TV Y VIDEO/TV LED Y SMART TV/',
            '/Tecnología/TV Y VIDEO/',
            '/Tecnología/'
        ]
        expected_result = ['TV LED Y SMART TV', 'Tecnología', 'TV Y VIDEO']
        result = self.crawler._Crawler__get_product_categories(categories)
        self.assertCountEqual(result, expected_result)

    def test_get_description(self):
        description = '<p style="text-align: center;"><strong>Sistema Operativo Android 10</strong><br /><strong>Modelo 50PUD7406/77&nbsp;</strong><br />Control por voz con el Asistente de Google.<br />HDR para im&aacute;genes brillantes.<br />Dise&ntilde;o atractivo y ultra fino, con marco negro mate Dolby Vision y Dolby Atmos para visi&oacute;n y sonido cinematogr&aacute;fico.<br />Se puede personalizar la pantalla de inicio para mostrar las apps preferidas, facilitando la reproducci&oacute;n de las pel&iacute;culas y los programas favoritos<br />Ideal para jugar con cualquier consola gracias a su bajo tiempo de latencia<br />Garant&iacute;a: 1 a&ntilde;o <br />Origen: Argentina.<br /><br /><strong>CARACTER&Iacute;STICAS DE PANTALLA</strong><br />Pulgadas 50<br />Resoluci&oacute;n De Video 4K Ultra HD<br />Resoluci&oacute;n 3840x2160<br />Radio De Aspecto 16:9<br />Tipo de TV Smart TV<br /><br /><strong>FUNCIONES ESPECIALES</strong><br />Smart Tv Si<br />Youtube Si<br />Netflix Si<br /><br /><strong>SONIDO</strong><br />Parlantes 2<br />Potencia De Parlantes 20 W<br /><br /><strong>CONECTIVIDAD</strong><br />Puerto Ethernet Si<br />Salida Para Auriculares Si<br />Bluetooth Si<br />Entradas Hdmi 4<br />Entradas Usb 2<br />OBSERVACIONES<br />Garantia 12 Meses<br /><br /><strong>PANTALLA</strong><br />Tipo De Pantalla LED<br /><br /><strong>DIMENSIONES</strong><br />Ancho 111.3 Cm<br />Profundidad 8.7 Cm<br />Alto 64.7 Cm<br /><br /><strong>DIMENSIONES (CON BASE)</strong><br />Alto (con Base) 67 Cm<br />Ancho (con Base) 111 Cm<br />Profundidad (con Base) 24.8 Cm</p>'
        expected_result = "**Sistema Operativo Android 10**  \n **Modelo 50PUD7406/77  **  \nControl por voz con el Asistente de Google.  \nHDR para imagenes brillantes.  \nDiseño atractivo y ultra fino, con marco negro mate Dolby Vision y Dolby Atmos\npara vision y sonido cinematografico.  \nSe puede personalizar la pantalla de inicio para mostrar las apps preferidas,\nfacilitando la reproduccion de las peliculas y los programas favoritos  \nIdeal para jugar con cualquier consola gracias a su bajo tiempo de latencia  \nGarantia: 1 año  \nOrigen: Argentina.  \n  \n **CARACTER ÍSTICAS DE PANTALLA**  \nPulgadas 50  \nResolucion De Video 4K Ultra HD  \nResolucion 3840x2160  \nRadio De Aspecto 16:9  \nTipo de TV Smart TV  \n  \n **FUNCIONES ESPECIALES**  \nSmart Tv Si  \nYoutube Si  \nNetflix Si  \n  \n **SONIDO**  \nParlantes 2  \nPotencia De Parlantes 20 W  \n  \n **CONECTIVIDAD**  \nPuerto Ethernet Si  \nSalida Para Auriculares Si  \nBluetooth Si  \nEntradas Hdmi 4  \nEntradas Usb 2  \nOBSERVACIONES  \nGarantia 12 Meses  \n  \n **PANTALLA**  \nTipo De Pantalla LED  \n  \n **DIMENSIONES**  \nAncho 111.3 Cm  \nProfundidad 8.7 Cm  \nAlto 64.7 Cm  \n  \n **DIMENSIONES (CON BASE)**  \nAlto (con Base) 67 Cm  \nAncho (con Base) 111 Cm  \nProfundidad (con Base) 24.8 Cm\n\n"
        result = self.crawler._Crawler__get_description(description)
        self.assertEqual(result, expected_result)

    def test_get_images(self):
        images = [
            {'imageId': '203278', 'imageLabel': '482038-01', 'imageTag': '<img src="~/arquivos/ids/203278-#width#-#height#/SMART-TV-ANDROID-PHILIPS-50-PULGADAS-4K-UHD-50PUD7406-77-1-29455.jpg?v=638034537715070000" width="#width#" height="#height#" alt="SMART-TV-ANDROID-PHILIPS-50-PULGADAS-4K-UHD-50PUD7406-77-1-29455" id="" />', 'imageUrl': 'https://hiperlibertad.vteximg.com.br/arquivos/ids/203278/SMART-TV-ANDROID-PHILIPS-50-PULGADAS-4K-UHD-50PUD7406-77-1-29455.jpg?v=638034537715070000', 'imageText': 'SMART-TV-ANDROID-PHILIPS-50-PULGADAS-4K-UHD-50PUD7406-77-1-29455', 'imageLastModified': '2022-11-07T21:36:11.5070000Z'}, {'imageId': '203261', 'imageLabel': '482038-02', 'imageTag': '<img src="~/arquivos/ids/203261-#width#-#height#/SMART-TV-ANDROID-PHILIPS-50-PULGADAS-4K-UHD-50PUD7406-77-2-29455.jpg?v=638034537661900000" width="#width#" height="#height#" alt="SMART-TV-ANDROID-PHILIPS-50-PULGADAS-4K-UHD-50PUD7406-77-2-29455" id="" />', 'imageUrl': 'https://hiperlibertad.vteximg.com.br/arquivos/ids/203261/SMART-TV-ANDROID-PHILIPS-50-PULGADAS-4K-UHD-50PUD7406-77-2-29455.jpg?v=638034537661900000', 'imageText': 'SMART-TV-ANDROID-PHILIPS-50-PULGADAS-4K-UHD-50PUD7406-77-2-29455', 'imageLastModified': '2022-11-07T21:36:06.1900000Z'}
        ]
        expected_result = [
            'https://hiperlibertad.vteximg.com.br/arquivos/ids/203278/SMART-TV-ANDROID-PHILIPS-50-PULGADAS-4K-UHD-50PUD7406-77-1-29455.jpg?v=638034537715070000',
            'https://hiperlibertad.vteximg.com.br/arquivos/ids/203261/SMART-TV-ANDROID-PHILIPS-50-PULGADAS-4K-UHD-50PUD7406-77-2-29455.jpg?v=638034537661900000'
        ]
        result = self.crawler._Crawler__get_images(images)
        self.assertEqual(result, expected_result)

    def test_get_payment_options(self):
        payment_options = {
            'installmentOptions':[{'paymentSystem': '1', 'bin': None, 'paymentName': 'American Express', 'paymentGroupName': 'creditCardPaymentGroup', 'value': 16486320, 'installments': [{'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320}]}, {'count': 2, 'hasInterestRate': True, 'interestRate': 640, 'value': 9298284, 'total': 18596568, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 2, 'hasInterestRate': True, 'interestRate': 640, 'value': 9298284, 'total': 18596568}]}, {'count': 3, 'hasInterestRate': True, 'interestRate': 613, 'value': 6506051, 'total': 19518153, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 3, 'hasInterestRate': True, 'interestRate': 613, 'value': 6506051, 'total': 19518153}]}, {'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320}]}, {'count': 12, 'hasInterestRate': True, 'interestRate': 470, 'value': 2148717, 'total': 25784604, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 12, 'hasInterestRate': True, 'interestRate': 470, 'value': 2148717, 'total': 25784604}]}, {'count': 18, 'hasInterestRate': True, 'interestRate': 524, 'value': 1779789, 'total': 32036202, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 18, 'hasInterestRate': True, 'interestRate': 524, 'value': 1779789, 'total': 32036202}]}]}, {'paymentSystem': '2', 'bin': None, 'paymentName': 'Visa', 'paymentGroupName': 'creditCardPaymentGroup', 'value': 16486320, 'installments': [{'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320}]}, {'count': 2, 'hasInterestRate': False, 'interestRate': 0, 'value': 8243160, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 2, 'hasInterestRate': False, 'interestRate': 0, 'value': 8243160, 'total': 16486320}]}, {'count': 3, 'hasInterestRate': False, 'interestRate': 0, 'value': 5495440, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 3, 'hasInterestRate': False, 'interestRate': 0, 'value': 5495440, 'total': 16486320}]}, {'count': 4, 'hasInterestRate': False, 'interestRate': 0, 'value': 4121580, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 4, 'hasInterestRate': False, 'interestRate': 0, 'value': 4121580, 'total': 16486320}]}, {'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320}]}, {'count': 9, 'hasInterestRate': False, 'interestRate': 0, 'value': 1831813, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 9, 'hasInterestRate': False, 'interestRate': 0, 'value': 1831813, 'total': 16486320}]}, {'count': 11, 'hasInterestRate': False, 'interestRate': 0, 'value': 1498756, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 11, 'hasInterestRate': False, 'interestRate': 0, 'value': 1498756, 'total': 16486320}]}, {'count': 12, 'hasInterestRate': False, 'interestRate': 0, 'value': 1373860, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 12, 'hasInterestRate': False, 'interestRate': 0, 'value': 1373860, 'total': 16486320}]}]}, {'paymentSystem': '3', 'bin': None, 'paymentName': 'Diners', 'paymentGroupName': 'creditCardPaymentGroup', 'value': 16486320, 'installments': [{'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320}]}, {'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320}]}, {'count': 12, 'hasInterestRate': True, 'interestRate': 470, 'value': 2148717, 'total': 25784604, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 12, 'hasInterestRate': True, 'interestRate': 470, 'value': 2148717, 'total': 25784604}]}, {'count': 18, 'hasInterestRate': True, 'interestRate': 524, 'value': 1779789, 'total': 32036202, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 18, 'hasInterestRate': True, 'interestRate': 524, 'value': 1779789, 'total': 32036202}]}]}, {'paymentSystem': '4', 'bin': None, 'paymentName': 'Mastercard', 'paymentGroupName': 'creditCardPaymentGroup', 'value': 16486320, 'installments': [{'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320}]}, {'count': 2, 'hasInterestRate': True, 'interestRate': 670, 'value': 9347743, 'total': 18695486, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 2, 'hasInterestRate': True, 'interestRate': 670, 'value': 9347743, 'total': 18695486}]}, {'count': 3, 'hasInterestRate': False, 'interestRate': 0, 'value': 5495440, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 3, 'hasInterestRate': False, 'interestRate': 0, 'value': 5495440, 'total': 16486320}]}, {'count': 4, 'hasInterestRate': False, 'interestRate': 0, 'value': 4121580, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 4, 'hasInterestRate': False, 'interestRate': 0, 'value': 4121580, 'total': 16486320}]}, {'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320}]}, {'count': 12, 'hasInterestRate': True, 'interestRate': 470, 'value': 2148717, 'total': 25784604, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 12, 'hasInterestRate': True, 'interestRate': 470, 'value': 2148717, 'total': 25784604}]}, {'count': 18, 'hasInterestRate': True, 'interestRate': 524, 'value': 1779789, 'total': 32036202, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 18, 'hasInterestRate': True, 'interestRate': 524, 'value': 1779789, 'total': 32036202}]}]}, {'paymentSystem': '10', 'bin': None, 'paymentName': 'Visa Electron', 'paymentGroupName': 'debitCardPaymentGroup', 'value': 16486320, 'installments': [{'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320}]}]}, {'paymentSystem': '18', 'bin': None, 'paymentName': 'Mercado Pago', 'paymentGroupName': 'MercadoPagoPaymentGroup', 'value': 16486320, 'installments': [{'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320}]}]}, {'paymentSystem': '33', 'bin': None, 'paymentName': 'Cabal', 'paymentGroupName': 'creditCardPaymentGroup', 'value': 16486320, 'installments': [{'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320}]}, {'count': 2, 'hasInterestRate': True, 'interestRate': 670, 'value': 9347743, 'total': 18695486, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 2, 'hasInterestRate': True, 'interestRate': 670, 'value': 9347743, 'total': 18695486}]}, {'count': 3, 'hasInterestRate': False, 'interestRate': 0, 'value': 5495440, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 3, 'hasInterestRate': False, 'interestRate': 0, 'value': 5495440, 'total': 16486320}]}, {'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320}]}, {'count': 12, 'hasInterestRate': True, 'interestRate': 470, 'value': 2148717, 'total': 25784604, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 12, 'hasInterestRate': True, 'interestRate': 470, 'value': 2148717, 'total': 25784604}]}, {'count': 18, 'hasInterestRate': True, 'interestRate': 524, 'value': 1779789, 'total': 32036202, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 18, 'hasInterestRate': True, 'interestRate': 524, 'value': 1779789, 'total': 32036202}]}]}, {'paymentSystem': '35', 'bin': None, 'paymentName': 'Naranja', 'paymentGroupName': 'creditCardPaymentGroup', 'value': 16486320, 'installments': [{'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320}]}, {'count': 3, 'hasInterestRate': False, 'interestRate': 0, 'value': 5495440, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 3, 'hasInterestRate': False, 'interestRate': 0, 'value': 5495440, 'total': 16486320}]}, {'count': 4, 'hasInterestRate': False, 'interestRate': 0, 'value': 4121580, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 4, 'hasInterestRate': False, 'interestRate': 0, 'value': 4121580, 'total': 16486320}]}, {'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 6, 'hasInterestRate': False, 'interestRate': 0, 'value': 2747720, 'total': 16486320}]}]}, {'paymentSystem': '39', 'bin': None, 'paymentName': 'Maestro', 'paymentGroupName': 'debitCardPaymentGroup', 'value': 16486320, 'installments': [{'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320}]}]}, {'paymentSystem': '65', 'bin': None, 'paymentName': 'Mastercard Debit', 'paymentGroupName': 'debitCardPaymentGroup', 'value': 16486320, 'installments': [{'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320, 'sellerMerchantInstallments': [{'id': 'HIPERLIBERTAD', 'count': 1, 'hasInterestRate': False, 'interestRate': 0, 'value': 16486320, 'total': 16486320}]}]}], 'paymentSystems': [{'id': 18, 'name': 'Mercado Pago', 'groupName': 'MercadoPagoPaymentGroup', 'validator': None, 'stringId': '18', 'template': 'MercadoPagoPaymentGroup-template', 'requiresDocument': True, 'isCustom': False, 'description': None, 'requiresAuthentication': False, 'dueDate': '2023-06-07T02:58:50.9855217Z', 'availablePayments': None}, {'id': 65, 'name': 'Mastercard Debit', 'groupName': 'debitCardPaymentGroup', 'validator': None, 'stringId': '65', 'template': 'debitCardPaymentGroup-template', 'requiresDocument': True, 'isCustom': False, 'description': None, 'requiresAuthentication': False, 'dueDate': '2023-06-07T02:58:50.9855217Z', 'availablePayments': None}, {'id': 39, 'name': 'Maestro', 'groupName': 'debitCardPaymentGroup', 'validator': None, 'stringId': '39', 'template': 'debitCardPaymentGroup-template', 'requiresDocument': False, 'isCustom': False, 'description': None, 'requiresAuthentication': False, 'dueDate': '2023-06-07T02:58:50.9855217Z', 'availablePayments': None}, {'id': 10, 'name': 'Visa Electron', 'groupName': 'debitCardPaymentGroup', 'validator': None, 'stringId': '10', 'template': 'debitCardPaymentGroup-template', 'requiresDocument': False, 'isCustom': False, 'description': None, 'requiresAuthentication': False, 'dueDate': '2023-06-07T02:58:50.9855217Z', 'availablePayments': None}, {'id': 1, 'name': 'American Express', 'groupName': 'creditCardPaymentGroup', 'validator': None, 'stringId': '1', 'template': 'creditCardPaymentGroup-template', 'requiresDocument': False, 'isCustom': False, 'description': None, 'requiresAuthentication': False, 'dueDate': '2023-06-07T02:58:50.9855217Z', 'availablePayments': None}, {'id': 3, 'name': 'Diners', 'groupName': 'creditCardPaymentGroup', 'validator': None, 'stringId': '3', 'template': 'creditCardPaymentGroup-template', 'requiresDocument': False, 'isCustom': False, 'description': None, 'requiresAuthentication': False, 'dueDate': '2023-06-07T02:58:50.9855217Z', 'availablePayments': None}, {'id': 33, 'name': 'Cabal', 'groupName': 'creditCardPaymentGroup', 'validator': None, 'stringId': '33', 'template': 'creditCardPaymentGroup-template', 'requiresDocument': False, 'isCustom': False, 'description': None, 'requiresAuthentication': False, 'dueDate': '2023-06-07T02:58:50.9855217Z', 'availablePayments': None}, {'id': 4, 'name': 'Mastercard', 'groupName': 'creditCardPaymentGroup', 'validator': None, 'stringId': '4', 'template': 'creditCardPaymentGroup-template', 'requiresDocument': False, 'isCustom': False, 'description': None, 'requiresAuthentication': False, 'dueDate': '2023-06-07T02:58:50.9855217Z', 'availablePayments': None}, {'id': 2, 'name': 'Visa', 'groupName': 'creditCardPaymentGroup', 'validator': None, 'stringId': '2', 'template': 'creditCardPaymentGroup-template', 'requiresDocument': False, 'isCustom': False, 'description': None, 'requiresAuthentication': False, 'dueDate': '2023-06-07T02:58:50.9855217Z', 'availablePayments': None}, {'id': 35, 'name': 'Naranja', 'groupName': 'creditCardPaymentGroup', 'validator': None, 'stringId': '35', 'template': 'creditCardPaymentGroup-template', 'requiresDocument': False, 'isCustom': False, 'description': None, 'requiresAuthentication': False, 'dueDate': '2023-06-07T02:58:50.9855217Z', 'availablePayments': None}], 'payments': [], 'giftCards': [], 'giftCardMessages': [], 'availableAccounts': [], 'availableTokens': []
        }
        expected_result = [
            {'Type': 'Mercado Pago', 'Options': [{'Installments': 1, 'MonthlyPayment': 16486320, 'Total': 16486320, 'InterestRate': 0}], 'ValidUntil': '2023-06-07T02:58:50.9855217Z'}, {'Type': 'Mastercard Debit', 'Options': [{'Installments': 1, 'MonthlyPayment': 16486320, 'Total': 16486320, 'InterestRate': 0}], 'ValidUntil': '2023-06-07T02:58:50.9855217Z'}, {'Type': 'Maestro', 'Options': [{'Installments': 1, 'MonthlyPayment': 16486320, 'Total': 16486320, 'InterestRate': 0}], 'ValidUntil': '2023-06-07T02:58:50.9855217Z'}, {'Type': 'Visa Electron', 'Options': [{'Installments': 1, 'MonthlyPayment': 16486320, 'Total': 16486320, 'InterestRate': 0}], 'ValidUntil': '2023-06-07T02:58:50.9855217Z'}, {'Type': 'American Express', 'Options': [{'Installments': 1, 'MonthlyPayment': 16486320, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 2, 'MonthlyPayment': 9298284, 'Total': 18596568, 'InterestRate': 640}, {'Installments': 3, 'MonthlyPayment': 6506051, 'Total': 19518153, 'InterestRate': 613}, {'Installments': 6, 'MonthlyPayment': 2747720, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 12, 'MonthlyPayment': 2148717, 'Total': 25784604, 'InterestRate': 470}, {'Installments': 18, 'MonthlyPayment': 1779789, 'Total': 32036202, 'InterestRate': 524}], 'ValidUntil': '2023-06-07T02:58:50.9855217Z'}, {'Type': 'Diners', 'Options': [{'Installments': 1, 'MonthlyPayment': 16486320, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 6, 'MonthlyPayment': 2747720, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 12, 'MonthlyPayment': 2148717, 'Total': 25784604, 'InterestRate': 470}, {'Installments': 18, 'MonthlyPayment': 1779789, 'Total': 32036202, 'InterestRate': 524}], 'ValidUntil': '2023-06-07T02:58:50.9855217Z'}, {'Type': 'Cabal', 'Options': [{'Installments': 1, 'MonthlyPayment': 16486320, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 2, 'MonthlyPayment': 9347743, 'Total': 18695486, 'InterestRate': 670}, {'Installments': 3, 'MonthlyPayment': 5495440, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 6, 'MonthlyPayment': 2747720, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 12, 'MonthlyPayment': 2148717, 'Total': 25784604, 'InterestRate': 470}, {'Installments': 18, 'MonthlyPayment': 1779789, 'Total': 32036202, 'InterestRate': 524}], 'ValidUntil': '2023-06-07T02:58:50.9855217Z'}, {'Type': 'Mastercard', 'Options': [{'Installments': 1, 'MonthlyPayment': 16486320, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 2, 'MonthlyPayment': 9347743, 'Total': 18695486, 'InterestRate': 670}, {'Installments': 3, 'MonthlyPayment': 5495440, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 4, 'MonthlyPayment': 4121580, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 6, 'MonthlyPayment': 2747720, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 12, 'MonthlyPayment': 2148717, 'Total': 25784604, 'InterestRate': 470}, {'Installments': 18, 'MonthlyPayment': 1779789, 'Total': 32036202, 'InterestRate': 524}], 'ValidUntil': '2023-06-07T02:58:50.9855217Z'}, {'Type': 'Visa', 'Options': [{'Installments': 1, 'MonthlyPayment': 16486320, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 2, 'MonthlyPayment': 8243160, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 3, 'MonthlyPayment': 5495440, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 4, 'MonthlyPayment': 4121580, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 6, 'MonthlyPayment': 2747720, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 9, 'MonthlyPayment': 1831813, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 11, 'MonthlyPayment': 1498756, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 12, 'MonthlyPayment': 1373860, 'Total': 16486320, 'InterestRate': 0}], 'ValidUntil': '2023-06-07T02:58:50.9855217Z'}, {'Type': 'Naranja', 'Options': [{'Installments': 1, 'MonthlyPayment': 16486320, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 3, 'MonthlyPayment': 5495440, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 4, 'MonthlyPayment': 4121580, 'Total': 16486320, 'InterestRate': 0}, {'Installments': 6, 'MonthlyPayment': 2747720, 'Total': 16486320, 'InterestRate': 0}], 'ValidUntil': '2023-06-07T02:58:50.9855217Z'}
        ]
        result = self.crawler._Crawler__get_payment_options(payment_options)
        self.assertEqual(result, expected_result)

    def test_save_csv(self):
        name = "TestStore"
        self.crawler.scraped_products = [
            {"id": 1, "name": "Product 1", "price": 10},
            {"id": 2, "name": "Product 2", "price": 20},
            {"id": 3, "name": "Product 3", "price": 30}
        ]
        total_rows = len(self.crawler.scraped_products) + 1
        self.crawler.created_at = "2023-05-01"
        self.crawler._Crawler__save_csv(name)

        file_name = f'{name.replace(" ", "")}_{self.crawler.created_at.replace("-", "")}.csv'
        file_path = os.path.join(CSVS_PATH, file_name)
        self.assertTrue(os.path.exists(file_path))

        with open(file_path, 'r') as file:
            lines = file.readlines()
            self.assertEqual(len(lines), total_rows)  # Header + 3 rows
            

        os.remove(file_path)

if __name__ == '__main__':
    unittest.main()
